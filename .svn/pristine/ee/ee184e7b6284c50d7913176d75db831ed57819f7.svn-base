<?php

use yii\helpers\Html;
use yii\grid\GridView;
use yii\widgets\ActiveForm;
use kartik\select2\Select2;
/* @var $this yii\web\View */
/* @var $searchModel app\home\models\searchs\CustomerSearch */
/* @var $dataProvider yii\data\ActiveDataProvider */

$this->title = '客户列表';
$this->params['breadcrumbs'][] = $this->title;
?>
<section class="content">
    <div class="row">
        <div class="col-xs-12">


            <div class="box">

                <!-- /.box-header -->
                <div class="box-body">


<?php echo $this->render('_search',['model'=>$searchModel]);?>
<?php $form = ActiveForm::begin(['id'=>'fpform','action'=>\yii\helpers\Url::to(['select'])]); ?>
    <?= GridView::widget([
        'dataProvider' => $dataProvider,
        'options' => [
            'id' => 'grid'
        ],
        'columns' => [

            ['class' => 'yii\grid\CheckboxColumn','name' => 'id'],
            'code',
            [
                'label'=>'操作员',
                'value'=>function($data){
                    return $data->user->realname?$data->user->realname:$data->user->username;
                }

            ],
            'name',
            [
                'label'=>'联系方式',
                'attribute'=>'tel1'
            ],

            [
              'label'=>'客户地址',
                'value'=>function($data){
                    return $data->getAddr();
                }
            ],

            [
                'attribute'=>'status',
                'value'=>function($data){
                    return $data->getStatus();
                }
            ],
            [
                'attribute' => 'created_at',
                'format' => ['date', 'php:Y-m-d H:i:s'],
            ],


            ['class' => 'app\admin\components\ActionColumn','template'=>'{update} {delete}'],

        ],
    ]); ?>

                    <?php if($this->context->gate('customer.select')){?>
                    <div class="row">
                    <div class='col-xs-5'>
                        <div class='col-xs-4'>
<?php
echo Select2::widget([
    'name' => 'user_id',
    'value' => '',
    'data' => \yii\helpers\ArrayHelper::map(\app\home\models\User::find()->where(['platform_id' =>  $this->context->platform_id,'group_id'=>3])->andWhere(['<>', 'id', $this->context->uid])->all(), 'id', 'realname'),
    'options' => ['placeholder' => '选择业务员...', 'multiple' => false],
]);
?>
</div>
                        <div class='col-xs-2'>
<?= Html::submitButton('分配',  ['class' => 'btn btn-warning']) ?>
                            </div>
</div>
                    </div>
                    <?php }?>
<?php ActiveForm::end(); ?>
</div></div></div></div></section>


<?php \common\widgets\JsBlock::begin();?>
    <script>

        ajax_form('fpform');
    </script>
<?php \common\widgets\JsBlock::end();?>