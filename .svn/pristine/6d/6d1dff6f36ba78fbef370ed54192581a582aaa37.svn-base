<?php

use yii\helpers\Html;
use yii\widgets\ActiveForm;
use kartik\select2\Select2;
use yii\web\JsExpression;
use dosamigos\datetimepicker\DateTimePicker;
use kartik\widgets\TimePicker;
/* @var $this yii\web\View */
/* @var $model app\home\models\Order */
/* @var $form yii\widgets\ActiveForm */
?>

<div class="order-form">

    <?php $form = ActiveForm::begin(['id'=>$model->formName(), 'enableAjaxValidation'=>true]); ?>

    <?php


    echo $form->field($model, 'cid')->widget(Select2::classname(), [
        'options' => ['placeholder' => '输入客户名称或者编号搜索...','multiple' => false],
        'initValueText'=>$model->isNewRecord||$model->cid==0?'':$model->customer->name."({$model->customer->code})",
        'theme' => Select2::THEME_KRAJEE,
        'language' => 'en',
        'pluginOptions' => [
            'allowClear' => true,
            'minimumInputLength' => 1,
            'language' => [
                'errorLoading' => new JsExpression("function () { return 'Waiting for results...'; }"),
            ],
            'ajax' => [
                'url' => \yii\helpers\Url::to(['/ajax/customer']),
                'dataType' => 'json',
                'data' => new JsExpression('function(params) { return {q:params.term}; }')
            ],
            'escapeMarkup' => new JsExpression('function (markup) { return markup; }'),
            'templateResult' => new JsExpression('function(city) { return city.text; }'),
            'templateSelection' => new JsExpression('function (city) { return city.text; }'),
        ],
    ]);
    ?>

    <?= $form->field($model, 'num')->textInput() ?>

    <div class="row">
        <div class="col-xs-3">
            <?= $form->field($model, 'delivery_date')->widget(DateTimePicker::className(), [
                'language' => 'zh-CN',
                'size' => 'xs',
                'template' => '{input}',
                'pickButtonIcon' => 'glyphicon glyphicon-time',
//        'inline' => true,
                'clientOptions' => [
                    'startView' => 2,
                    'minView'=>2,
                    'autoclose' => true,
                    'format' => 'yyyy-mm-dd', // if inline = true
                    // 'format' => 'HH:ii P', // if inline = false
                    'todayBtn' => true
                ]
            ]);?>
        </div>
        </div>


    <?= $form->field($model, 'delivery_time')->widget(TimePicker::classname(), ['pluginOptions'=>[
            'showSeconds' => false,
            'showMeridian' => false,
            'minuteStep' => 1,
            'secondStep' => 5,
]]) ?>

    <?= $form->field($model, 'note')->textarea(['rows' => 3]) ?>



    <div class="form-group">
        <?= Html::submitButton($model->isNewRecord ? '添加' : '更新', ['class' => $model->isNewRecord ? 'btn btn-success' : 'btn btn-primary']) ?>
    </div>

    <?php ActiveForm::end(); ?>

</div>

<?php  \common\widgets\JsBlock::begin();?>
<script>
    $(function(){
        ajax_form('<?php  echo $model->formName();?>','<?php  echo \yii\helpers\Url::to(['index']);?>');
    })

</script>
<?php  \common\widgets\JsBlock::end();?>


