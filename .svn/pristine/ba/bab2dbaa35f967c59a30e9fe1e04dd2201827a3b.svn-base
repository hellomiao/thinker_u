<?php

use yii\helpers\Html;
use yii\widgets\ActiveForm;
use dosamigos\datetimepicker\DateTimePicker;

/* @var $this yii\web\View */
/* @var $model app\home\models\searchs\OrderSearch */
/* @var $form yii\widgets\ActiveForm */
?>
<style>
    /*a  upload */
    .a-upload {

        position: relative;
        overflow: hidden;
        display: inline-block;
        *display: inline;
        *zoom: 1
    }

    .a-upload input {
        position: absolute;
        font-size: 100px;
        right: 0;
        top: 0;
        opacity: 0;
        filter: alpha(opacity=0);
        cursor: pointer
    }

    .a-upload:hover {
        color: #444;
        background: #eee;
        border-color: #ccc;
        text-decoration: none
    }

</style>

<div class="order-search">
    <div class="row">
        <div class="col-xs-6">
    <?php $form = ActiveForm::begin(['id' => 'order_form',
        'action' => ['index'],
        'method' => 'get', 'options' => ['data-pjax' => true,'enctype'=>"multipart/form-data"],
    ]); ?>
    <div class="row">


        <div class="col-xs-4">
            <?php $model->delivery_date = date("Y-m-d",strtotime("+1 days"));?>
            <?= $form->field($model, 'delivery_date')->widget(DateTimePicker::className(), [
                'language' => 'zh-CN',
                'size' => 'xs',
                'template' => '{input}',
                'pickButtonIcon' => 'glyphicon glyphicon-time',
//        'inline' => true,
                'clientOptions' => [
                    'startView' => 2,
                    'minView' => 2,
                    'autoclose' => true,
                    'format' => 'yyyy-mm-dd', // if inline = true
                    // 'format' => 'HH:ii P', // if inline = false
                    'todayBtn' => true
                ]
            ]); ?>
        </div>

        <div class="col-xs-4">
            <?= $form->field($model, 'start_ctime')->widget(DateTimePicker::className(), [
                'language' => 'zh-CN',
                'size' => 'xs',
                'template' => '{input}',
                'pickButtonIcon' => 'glyphicon glyphicon-time',
//        'inline' => true,
                'clientOptions' => [
                    'startView' => 2,
                    'minView' => 0,
                    'autoclose' => true,
                    'format' => 'yyyy-mm-dd h:ii', // if inline = true
                    // 'format' => 'HH:ii P', // if inline = false
                    'todayBtn' => true
                ]
            ]); ?>
        </div>

        <div class="col-xs-4">
            <?= $form->field($model, 'end_ctime')->widget(DateTimePicker::className(), [
                'language' => 'zh-CN',
                'size' => 'xs',
                'template' => '{input}',
                'pickButtonIcon' => 'glyphicon glyphicon-time',
//        'inline' => true,
                'clientOptions' => [
                    'startView' => 2,
                    'minView' => 0,
                    'autoclose' => true,
                    'format' => 'yyyy-mm-dd h:ii', // if inline = true
                    // 'format' => 'HH:ii P', // if inline = false
                    'todayBtn' => true
                ]
            ]); ?>
        </div>

        <div class='col-xs-3'><?= $form->field($model, 'keywords')->label('配送客户') ?></div>


    </div>
    <div class="form-group">
        <?= Html::submitButton('搜索', ['class' => 'btn btn-primary search-btn']) ?>
        <?= Html::a('添加订单', ['create'], ['class' => 'btn btn-success']) ?>
        <?= Html::a('导出', "javascript:void(0);", ['class' => 'btn btn-info export-btn']) ?>

    </div>


    <?php ActiveForm::end(); ?>
            </div>


        <div class="col-xs-4" style="position: absolute;top: 85px;left: 210px">

            <?php $form = ActiveForm::begin([ 'id'=>'importForm','action'=>\yii\helpers\Url::to(['import']),'options'=>['enctype'=>"multipart/form-data"]]);?>
            <a href="javascript:;" class="a-upload btn btn-default">
                <input type="file" name="excel" id="">选择文件
            </a>
            <a href="javascript:;" class="btn"><span class="showFileName"></span></a>
            <?= Html::a('导入', "javascript:void(0);", ['class' => 'btn btn-danger import-btn']) ?>
            <?php ActiveForm::end(); ?>
        </div>

        </div>
</div>


<?php \common\widgets\JsBlock::begin() ?>

<script>
    ajax_form('importForm');
    $(".search-btn").on("click", function () {
        $("#order_form").attr('data-pjax', true);
        $("#order_form").attr("action", '<?php echo \yii\helpers\Url::to(['index']);?>');
        $("#order_form").attr("method", 'get');
        $("#order_form").submit();
    });

    $(".export-btn").on("click", function () {

        $("#order_form").removeAttr('data-pjax');
        var start_time = $("#ordersearch-start_ctime").val();
        var end_time = $("#ordersearch-end_ctime").val();
        if (!start_time && !end_time) {
            layer.msg('导出功能下单开始时间和结束时间必须选', {time: 2000, icon: 5});
            return false;
        }
        $("#order_form").attr("method", 'post');
        $("#order_form").attr("action", '<?php echo \yii\helpers\Url::to(['export']);?>');
        $("#order_form").submit();


    });

    $(".a-upload").on("change", "input[name='excel']", function () {
        var filePath = $(this).val();
        var arr = filePath.split('\\');
        var fileName = arr[arr.length - 1];
        $(".showFileName").html(fileName);

    });

    $(".import-btn").on("click", function () {


        var file = $("input[name='excel']").val();
        if (!file) {
            layer.msg('请选择要导入的EXCEL', {time: 2000, icon: 5});
            return false;
        }

        $("#importForm").submit();



    });



</script>
<?php \common\widgets\JsBlock::end() ?>
