<?php
/**
 * Created by PhpStorm.
 * User: yangchunrun
 * Date: 17/4/19
 * Time: 下午6:44
 */

namespace app\admin\api;


use app\admin\models\Admin;
use app\admin\models\Notice;
use app\api\components\BaseApi;
use app\base\models\Config;

class ApplyNotice extends BaseApi
{
    protected function rules()
    {
        return [
            'access_token' => ['required' => true, 'name' => 'access_token', "message" => "access_token是必需的"],
            'notice_id' => ['required' => true, 'name' => '通知id'],
        ];
    }

    public function run()
    {
        $params = $this->params;
        $admin = new Admin();
        $user = $admin->getUserByToken($params['access_token']);
        if (!$user) {
            return $this->formatData([], 1005, 'token不正确!');
        }

        $id = $params['notice_id'];
        $model = Notice::findOne($id);
        if ($model->status!=1) {
            return $this->formatData([], 1005, '不能申请恢复供电');
        }
        $model->status = 3;
        $model->save();
        return $this->formatData([]);

    }

}