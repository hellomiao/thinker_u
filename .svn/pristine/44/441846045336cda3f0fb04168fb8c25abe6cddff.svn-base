<?php

use yii\helpers\Html;
use yii\widgets\DetailView;
use yii\grid\GridView;

/* @var $this yii\web\View */
/* @var $model app\home\models\Driver */

$this->title = $model->username;
$this->params['breadcrumbs'][] = ['label' => '司机列表', 'url' => ['index']];
$this->params['breadcrumbs'][] = $this->title;
?>
    <section class="content">
        <div class="row">
            <div class="col-xs-12">


                <div class="box">

                    <!-- /.box-header -->
                    <div class="box-body">


                        <p>
                            <?= Html::a('更新', ['update', 'id' => $model->id], ['class' => 'btn btn-primary']) ?>

                        </p>

                        <?= DetailView::widget([
                            'model' => $model,
                            'attributes' => [
                                'id',
                                'username',
                                'phone',
                                'car_type',
                                'car_number',
                                'inner_size',
                                'outer_size',
                                [
                                    'attribute' => 'limit_days',
                                    'value' => $model->getWeekStr()
                                ],
                                [
                                    'attribute' => 'created_at',
                                    'format' => ['date', 'php:Y-m-d H:i:s'],
                                ]
                            ],
                        ]) ?>


                    </div>


                </div>

                <?php if($this->context->gate("driver.goods-num")){?>

                <div class="box">
                    <div class="box-header with-border">
                        <h3 class="box-title">货物</h3>


                    </div>
                    <div class="box-body">
                        <?= GridView::widget([
                            'dataProvider' => $dataProvider,
                            'filterModel' => $searchModel,
                            'layout' => "{items}\n{pager}",
                            'columns' => [

                                'name',
                                [
                                    'label' => '数量',
                                    'format' => 'raw',
                                    'value' => function ($data) use ($model) {

                                        $num = $data->getGoodsNum($model->id);
                                        return "<div  class='numDiv' style='width: 100%;height: 100%'><span class='numTxt'>{$num}</span><input name='num' data-id='{$data->id}' class='numInput' value='{$num}' type='number' style='display: none'/></div>";

                                    }
                                ]


                            ],
                        ]); ?>
                    </div>
                </div>

                <?php }?>

            </div>
        </div>
    </section>

<?php \common\widgets\JsBlock::begin(); ?>
    <script>
        var url='<?php echo \yii\helpers\Url::to(['goods-num']);?>',
            driver_id='<?php echo $model->id;?>';
        $(function () {

            $("body").on("click",function(){
                $('.numTxt').show();
                $('.numInput').hide();
            });

                $(document).on("click", ".numDiv", function () {
                var numTxt = $(this).children('.numTxt');
                var numInput = $(this).children('.numInput');
                numTxt.hide();
                numInput.show();

                numInput.blur(function () {
                    numTxt.show();
                    numInput.hide();
                    var id = $(this).data('id'),num=$(this).val();
                    $.post(url,{driver_id:driver_id,goods_id:id,num:num},function(d){
                        numTxt.text(num);
                    },'json');
                });
            })
        });
    </script>
<?php \common\widgets\JsBlock::end(); ?>